<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><link rel="stylesheet" type="text/css" href="isabelle.css"/>
<title>File ‹code_go.ML›</title>
</head>


<body>
<div class="head">
<h1>File ‹code_go.ML›</h1>
</div>

<pre class="source"><span>
</span><span class="keyword1"><span class="keyword"><span>signature</span></span></span><span> </span><span class="entity"><span>CODE_GO</span></span><span> </span><span class="main"><span>=</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>sig</span></span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> target</span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> </span><span class="entity"><span>Code_Go</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>CODE_GO</span></span><span> </span><span class="main"><span>=</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>struct</span></span></span><span>

</span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>Basic_Code_Symbol</span><span class="main"><span>;</span></span><span>
</span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>Basic_Code_Thingol</span><span class="main"><span>;</span></span><span>
</span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>Code_Printer</span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>infixr</span></span></span><span> </span><span class="inner_numeral"><span>5</span></span><span> @@</span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>infixr</span></span></span><span> </span><span class="inner_numeral"><span>5</span></span><span> @|</span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>target</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"Go"</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>map_terms_bottom_up</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="entity"><span>IConst</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>t</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>map_terms_bottom_up</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="entity"><span>IVar</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>t</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>map_terms_bottom_up</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t1</span></span><span> </span><span class="entity"><span>`$</span></span><span> </span><span class="entity"><span>t2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>f</span></span><span>
      </span><span class="main"><span>(</span></span><span class="entity"><span>map_terms_bottom_up</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>t1</span></span><span> </span><span class="entity"><span>`$</span></span><span> </span><span class="entity"><span>map_terms_bottom_up</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>t2</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>map_terms_bottom_up</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>v</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>`|=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rty</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>f</span></span><span>
      </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>v</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>`|=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>map_terms_bottom_up</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rty</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>map_terms_bottom_up</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ICase</span></span><span> </span><span class="main"><span>{</span></span><span> term </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>,</span></span><span> typ </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>,</span></span><span> clauses </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>clauses</span></span><span class="main"><span>,</span></span><span> primitive </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>t0</span></span><span> </span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>f</span></span><span>
      </span><span class="main"><span>(</span></span><span class="entity"><span>ICase</span></span><span> </span><span class="main"><span>{</span></span><span> term </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>map_terms_bottom_up</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>,</span></span><span> typ </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>,</span></span><span>
        clauses </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>o</span><span> </span><span>apply2</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>map_terms_bottom_up</span></span><span> </span><span class="entity"><span>f</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>clauses</span></span><span class="main"><span>,</span></span><span>
        primitive </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>map_terms_bottom_up</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>t0</span></span><span> </span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>range_of_head</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>fst</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Code_Thingol.unfold_app</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
    </span><span class="entity"><span>IConst</span></span><span> </span><span class="main"><span>{</span></span><span class="entity"><span>range</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>range</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>print_go_string</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>unicode</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"\\u"</span></span><span> </span><span>^</span><span> </span><span>align_right</span><span> </span><span class="inner_quoted"><span>"0"</span></span><span> </span><span class="inner_numeral"><span>4</span></span><span> </span><span class="main"><span>(</span></span><span>Int.fmt</span><span> </span><span>StringCvt.HEX</span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>char</span></span><span> </span><span class="inner_quoted"><span>"\""</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"\\\""</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>char</span></span><span> </span><span class="inner_quoted"><span>"\\"</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"\\\\"</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>char</span></span><span> </span><span class="entity"><span>c</span></span><span> </span><span class="main"><span>=</span></span><span>
         </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>ord</span><span> </span><span class="entity"><span>c</span></span><span>
         </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span>&lt;</span><span> </span><span class="inner_numeral"><span>32</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span>&gt;</span><span> </span><span class="inner_numeral"><span>126</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>unicode</span></span><span> </span><span class="entity"><span>i</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span>&gt;=</span><span> </span><span class="inner_numeral"><span>128</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>error</span><span> </span><span class="inner_quoted"><span>"non-ASCII byte in Go string literal"</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>c</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>quote</span><span> </span><span>o</span><span> </span><span>translate_string</span><span> </span><span class="entity"><span>char</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>


</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>block_enclose</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>prt1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>prt2</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>prts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="comment1"><span>(* Pretty.block_enclose (prt1, prt2) prts*)</span></span><span>
  </span><span>Pretty.chunks</span><span> </span><span class="main"><span>[</span></span><span>Pretty.block</span><span> </span><span class="main"><span>(</span></span><span>Pretty.fbreaks</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>Pretty.unbreakable</span><span> </span><span class="entity"><span>prt1</span></span><span class="main"><span>)</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>prts</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span>Pretty.unbreakable</span><span> </span><span class="entity"><span>prt2</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_go_numeral</span></span><span> </span><span class="entity"><span>num</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"Bigint.MkInt(\""</span></span><span> </span><span>^</span><span> </span><span>signed_string_of_int</span><span> </span><span class="entity"><span>num</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"\")"</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>literals</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Literals</span></span><span> </span><span class="main"><span>{</span></span><span>
  literal_string </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>print_go_string</span></span><span class="main"><span>,</span></span><span>
  literal_numeral </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>print_go_numeral</span></span><span class="main"><span>,</span></span><span>
  literal_list </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>enum</span></span><span> </span><span class="inner_quoted"><span>","</span></span><span> </span><span class="inner_quoted"><span>"["</span></span><span> </span><span class="inner_quoted"><span>"]"</span></span><span class="main"><span>,</span></span><span>
  infix_cons </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>6</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"&lt;no infix cons operator in  go&gt;"</span></span><span class="main"><span>)</span></span><span> </span><span class="comment1"><span>(* TODO: this will go wrong if ever used *)</span></span><span>
</span><span class="main"><span>}</span></span><span class="main"><span>;</span></span><span>



</span><span class="comment1"><span>(* the subset of thingol we actually need for Go *)</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>go_stmt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Fun</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> typscheme * </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>iterm list * iterm</span><span class="main"><span>)</span></span><span> * </span><span class="main"><span>(</span></span><span>thm option * bool</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> list
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Datatype</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> vname list * </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>string * vname list</span><span class="main"><span>)</span></span><span> * itype list</span><span class="main"><span>)</span></span><span> list
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Class</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span class="main"><span>(</span></span><span>vname * </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>class * class</span><span class="main"><span>)</span></span><span> list * </span><span class="main"><span>(</span></span><span>string * itype</span><span class="main"><span>)</span></span><span> list</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Datatypecons</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> string
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Instance</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span class="main"><span>{</span></span><span> class</span><span class="main"><span>:</span></span><span> string</span><span class="main"><span>,</span></span><span> tyco</span><span class="main"><span>:</span></span><span> string</span><span class="main"><span>,</span></span><span> vs</span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span>vname * sort</span><span class="main"><span>)</span></span><span> list</span><span class="main"><span>,</span></span><span>
        superinsts</span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span>class * </span><span class="main"><span>(</span></span><span>itype * dict list</span><span class="main"><span>)</span></span><span> list</span><span class="main"><span>)</span></span><span> list</span><span class="main"><span>,</span></span><span>
        inst_params</span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>string * </span><span class="main"><span>(</span></span><span>const * int</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> * </span><span class="main"><span>(</span></span><span>thm * bool</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> list</span><span class="main"><span>,</span></span><span>
        superinst_params</span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>string * </span><span class="main"><span>(</span></span><span>const * int</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> * </span><span class="main"><span>(</span></span><span>thm * bool</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> list </span><span class="main"><span>}</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_go_stmt</span></span><span> </span><span class="entity"><span>gen_stringer</span></span><span> </span><span class="entity"><span>undefineds</span></span><span> </span><span class="entity"><span>infinite_types</span></span><span> </span><span class="entity"><span>tyco_syntax</span></span><span> </span><span class="entity"><span>const_syntax</span></span><span> </span><span class="entity"><span>reserved</span></span><span>
    </span><span class="entity"><span>args_num</span></span><span> </span><span class="entity"><span>is_sum_type</span></span><span> </span><span class="entity"><span>is_class_param</span></span><span> </span><span class="entity"><span>is_constr</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>deresolve</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>deresolve_full</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>lookup_tyvar</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>lookup_var</span></span><span> </span><span class="entity"><span>tyvars</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>intro_tyvars</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>intro_vars</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>fst</span><span> </span><span class="entity"><span>vs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>deresolve_const</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>deresolve</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>Constant</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>deresolve_class</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>deresolve</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>Type_Class</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>deresolve_classrel</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>deresolve</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>Class_Relation</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>deresolve_inst</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>deresolve</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>Class_Instance</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>deresolve_tyco</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>deresolve</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>Type_Constructor</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>oneline</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Pretty.unbreakable</span><span> </span><span>o</span><span> </span><span class="entity"><span>semicolon</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>block</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Pretty.unbreakable</span><span> </span><span>o</span><span> </span><span>Pretty.block</span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>spaced</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Pretty.unbreakable</span><span> </span><span>o</span><span> </span><span class="entity"><span>concat</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_dest_name</span></span><span> </span><span class="entity"><span>name</span></span><span> </span><span class="main"><span>=</span></span><span>  </span><span>Long_Name.map_base_name</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>s</span></span><span>^</span><span class="inner_quoted"><span>"_dest"</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>name</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>applify_constraints</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="entity"><span>head</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>head</span></span><span>
     </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>applify_constraints</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>head</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>anys</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>block</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>commas</span></span><span> </span><span>o</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>lookup_tyvar</span></span><span> </span><span class="entity"><span>tyvars</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>vs</span></span><span>
         </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>block</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>head</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"["</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>anys</span></span><span class="main"><span>,</span></span><span> </span><span>Pretty.brk</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"any"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"]"</span></span><span class="main"><span>]</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_go_typ</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tyco</span></span><span> </span><span class="entity"><span>`%%</span></span><span> </span><span class="entity"><span>tys</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>tyco_syntax</span></span><span> </span><span class="entity"><span>tyco</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
        </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>apply_constraints</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>deresolve_tyco</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>tyco</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>tys</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>print</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>print</span></span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print_go_typ</span></span><span> </span><span class="entity"><span>tyvars</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>NOBR</span></span><span> </span><span class="entity"><span>tys</span></span><span class="main"><span>)</span></span><span>
    </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>print_go_typ</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ITyVar</span></span><span> </span><span class="entity"><span>v</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>lookup_tyvar</span></span><span> </span><span class="entity"><span>tyvars</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>v</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity"><span>apply_constraints</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>head</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>gen_applify</span></span><span> </span><span>false</span><span> </span><span class="inner_quoted"><span>"["</span></span><span> </span><span class="inner_quoted"><span>"]"</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print_go_typ</span></span><span> </span><span class="entity"><span>tyvars</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>NOBR</span></span><span> </span><span class="entity"><span>head</span></span><span> </span><span class="entity"><span>vs</span></span><span>

    </span><span class="comment1"><span>(* uncurried types of functions in type classes are special-cased here *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_go_typ_uncurried_toplevel</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>typ</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="inner_quoted"><span>"fun"</span></span><span> </span><span class="entity"><span>`%%</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>args</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rtyp</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Code_Thingol.unfold_fun</span></span><span> </span><span class="entity"><span>typ</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>head</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>applify</span></span><span> </span><span class="inner_quoted"><span>"("</span></span><span> </span><span class="inner_quoted"><span>")"</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print_go_typ</span></span><span> </span><span class="entity"><span>tyvars</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>NOBR</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"func"</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>args</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>concat</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>head</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>print_go_typ</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>rtyp</span></span><span class="main"><span>]</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
    </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>print_go_typ_uncurried_toplevel</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>typ</span></span><span> </span><span class="main"><span>=</span></span><span>
        </span><span class="entity"><span>block</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"func () "</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>print_go_typ</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>typ</span></span><span class="main"><span>]</span></span><span>

    </span><span class="comment1"><span>(* wrap a statement into an immediately called function to make it an expression *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>wrap_into_lambda</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>typ</span></span><span> </span><span class="entity"><span>body</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>block_enclose</span></span><span>
        </span><span class="main"><span>(</span></span><span class="entity"><span>concat</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"func ()"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>print_go_typ</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>typ</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"{"</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"}()"</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>body</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>wrap_in_return</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>oneline</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"return"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>]</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>wrap_if</span></span><span> </span><span>true</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>wrap_in_return</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>wrap_if</span></span><span> </span><span>false</span><span> </span><span class="main"><span>=</span></span><span> </span><span>I</span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_func</span></span><span> </span><span class="entity"><span>head</span></span><span> </span><span class="entity"><span>body</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>block_enclose</span></span><span>
      </span><span class="main"><span>(</span></span><span class="entity"><span>block</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"func "</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>head</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>" {"</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"}"</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>[</span></span><span class="entity"><span>body</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_func_head</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>const</span></span><span> </span><span class="entity"><span>tvs</span></span><span> </span><span class="entity"><span>extras</span></span><span> </span><span class="entity"><span>params</span></span><span> </span><span class="entity"><span>tys</span></span><span> </span><span class="entity"><span>rty</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>args</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>params</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>tys</span></span><span>
      </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>param</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
         </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>name</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>param</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
           </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="inner_quoted"><span>"_"</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>lookup_var</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>n</span></span><span class="main"><span>;</span></span><span>
         </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>Pretty.block</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>str</span></span><span> </span><span class="entity"><span>name</span></span><span class="main"><span>,</span></span><span> </span><span>Pretty.brk</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>print_go_typ</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>]</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>)</span></span><span>
      </span><span>|&gt;</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>@</span><span> </span><span class="entity"><span>extras</span></span><span class="main"><span>)</span></span><span>
      </span><span>|&gt;</span><span> </span><span class="entity"><span>enum</span></span><span> </span><span class="inner_quoted"><span>","</span></span><span> </span><span class="inner_quoted"><span>"("</span></span><span> </span><span class="inner_quoted"><span>")"</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>sym</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>const</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
        </span><span>SOME</span><span> </span><span class="entity"><span>name</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>deresolve</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>name</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>""</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>func_head</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>concat</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>applify_constraints</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>sym</span></span><span> </span><span class="entity"><span>tvs</span></span><span> </span><span>::</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>args</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rty</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>func_head</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="comment1"><span>(* a definition of a datatype *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_go_typedef</span></span><span> </span><span class="entity"><span>tyco</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>cos</span></span><span> </span><span class="entity"><span>reserved</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>p</span></span><span class="main"><span>,</span></span><span class="entity"><span>m</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Name.invent</span><span> </span><span class="main"><span>(</span></span><span>snd</span><span> </span><span class="entity"><span>reserved</span></span><span class="main"><span>)</span></span><span> </span><span class="inner_quoted"><span>"p"</span></span><span> </span><span class="inner_numeral"><span>2</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Name.declare</span><span> </span><span class="entity"><span>p</span></span><span> </span><span class="main"><span>(</span></span><span>Name.declare</span><span> </span><span class="entity"><span>m</span></span><span> </span><span class="main"><span>(</span></span><span>snd</span><span> </span><span class="entity"><span>reserved</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tyargs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>ITyVar</span></span><span> </span><span class="entity"><span>vs</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>self</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>tyco</span></span><span> </span><span class="entity"><span>`%%</span></span><span> </span><span class="entity"><span>tyargs</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>intro_tyvars</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>rpair</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>vs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>reserved</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>allowed_infinite</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>List.exists</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>tyco</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>infinite_types</span></span><span>

      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_constructor</span></span><span> </span><span class="entity"><span>m</span></span><span> </span><span class="entity"><span>type_name</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>name</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tys</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>named_fields</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Name.invent_names</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="inner_quoted"><span>"A"</span></span><span> </span><span class="entity"><span>tys</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>fields</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>named_fields</span></span><span>
         </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>name</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>arg</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>oneline</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>str</span></span><span> </span><span class="entity"><span>name</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>print_go_typ</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>arg</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>head</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>applify_constraints</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span class="entity"><span>name</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>vs</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>typ</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>apply_constraints</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span class="entity"><span>name</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>tyargs</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>elim_body</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>type_name</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>NONE</span><span>
          </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>case_branch</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>block</span></span><span>
              </span><span class="main"><span>[</span></span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"return "</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span>Pretty.block</span><span> </span><span>o</span><span> </span><span class="entity"><span>commas</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>field</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>p</span></span><span>^</span><span class="inner_quoted"><span>"."</span></span><span>^</span><span class="entity"><span>field</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>named_fields</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="comment1"><span>(*Pretty.chunks
            [oneline [str ((if null named_fields then "_ = " else m^" := ")^p^".("), typ , str ")"]
            ,*)</span></span><span> </span><span class="entity"><span>case_branch</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>Pretty.block</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>oneline</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"return "</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span>Pretty.block</span><span> </span><span>o</span><span> </span><span class="entity"><span>commas</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>field</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>p</span></span><span>^</span><span class="inner_quoted"><span>"."</span></span><span>^</span><span class="entity"><span>field</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>named_fields</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>]</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>elim_name</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_dest_name</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>type_name</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
            </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>name</span></span><span>
          </span><span class="main"><span>|</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>name'</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>name'</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>eliminator</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>null</span><span> </span><span class="entity"><span>tys</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>""</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>print_func</span></span><span>
          </span><span class="main"><span>(</span></span><span class="entity"><span>applify</span></span><span> </span><span class="inner_quoted"><span>"("</span></span><span> </span><span class="inner_quoted"><span>")"</span></span><span> </span><span>I</span><span> </span><span class="entity"><span>NOBR</span></span><span> </span><span class="main"><span>(</span></span><span>Pretty.block</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>applify_constraints</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span class="entity"><span>elim_name</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>vs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"("</span></span><span>^</span><span class="entity"><span>p</span></span><span>^</span><span class="inner_quoted"><span>" "</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>typ</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>")"</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>  </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print_go_typ</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span>o</span><span> </span><span>snd</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>named_fields</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span class="entity"><span>elim_body</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pretty</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>name</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"("</span></span><span> </span><span>^</span><span> </span><span class="main"><span>(</span></span><span>fold</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>^</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span class="inner_quoted"><span>"%v"</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>fields</span></span><span class="main"><span>)</span></span><span> </span><span class="inner_quoted"><span>""</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>")"</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>constr</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>oneline</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>block_enclose</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>concat</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"type"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>head</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"struct {"</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"}"</span></span><span class="main"><span>)</span></span><span>
          </span><span class="entity"><span>fields</span></span><span class="main"><span>]</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>constr</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>eliminator</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>not</span><span> </span><span class="entity"><span>allowed_infinite</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span> </span><span>length</span><span> </span><span class="entity"><span>cos</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>cos</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
        </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>name</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="entity"><span>tys</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>name</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>deresolve_const</span></span><span> </span><span class="entity"><span>name</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tname</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>deresolve_tyco</span></span><span> </span><span class="entity"><span>tyco</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>constr</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>dest</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>print_constructor</span></span><span> </span><span class="entity"><span>m</span></span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span class="entity"><span>name</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>tname</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tys</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>Pretty.chunks</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>constr</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>dest</span></span><span class="main"><span>]</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>constrs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>destrs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>cos</span></span><span>
            </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>name</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="entity"><span>tys</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>deresolve_const</span></span><span> </span><span class="entity"><span>name</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="entity"><span>tys</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
            </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print_constructor</span></span><span> </span><span class="entity"><span>m</span></span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span>
            </span><span>|&gt;</span><span> </span><span>split_list</span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>names</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>name</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>deresolve_const</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>name</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>cos</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>comment</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>block</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"// sum type which can be "</span></span><span> </span><span>::</span><span> </span><span>Pretty.commas</span><span> </span><span class="entity"><span>names</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>any</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>oneline</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"type"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>applify_constraints</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>deresolve_tyco</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>tyco</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>vs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"any"</span></span><span class="main"><span>]</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>Pretty.chunks</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>comment</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>any</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>constrs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>destrs</span></span><span class="main"><span>)</span></span><span>  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>


    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_classrels</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>ps</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Pretty.block</span><span> </span><span class="entity"><span>ps</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>print_classrels</span></span><span> </span><span class="entity"><span>rels</span></span><span> </span><span class="entity"><span>ps</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>postfix</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>rels</span></span><span>
          </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>self</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>super</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>Long_Name.base_name</span><span> </span><span>o</span><span> </span><span class="entity"><span>deresolve_classrel</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>self</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>super</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span>|&gt;</span><span> </span><span>rev</span><span>
          </span><span>|&gt;</span><span> </span><span>String.concatWith</span><span> </span><span class="inner_quoted"><span>"."</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>block</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ps</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"."</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="entity"><span>postfix</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_dict</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Dict</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>classrels</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>print_classrels</span></span><span> </span><span class="entity"><span>classrels</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print_plain_dict</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity"><span>print_plain_dict</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Dict_Const</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>inst</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>args</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>needs_mono</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>true</span><span> </span><span class="comment1"><span>(* not (length args = 0)*)</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>typargs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>dss</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>split_list</span><span> </span><span class="entity"><span>args</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>wrap</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>needs_mono</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>head</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>apply_constraints</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>head</span></span><span> </span><span class="entity"><span>typargs</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>I</span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>wrap</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>deresolve_inst</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>inst</span></span><span class="main"><span>)</span></span><span>
         </span><span>::</span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>needs_mono</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>enum</span></span><span> </span><span class="inner_quoted"><span>","</span></span><span> </span><span class="inner_quoted"><span>"("</span></span><span> </span><span class="inner_quoted"><span>")"</span></span><span class="main"><span>)</span></span><span> </span><span>o</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print_dict</span></span><span> </span><span class="entity"><span>tyvars</span></span><span class="main"><span>)</span></span><span> </span><span>o</span><span> </span><span>flat</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>dss</span></span><span class="main"><span>]</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
    </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>print_plain_dict</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Dict_Var</span></span><span> </span><span class="main"><span>{</span></span><span> </span><span class="entity"><span>var</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>index</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>length</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span> </span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="main"><span>[</span></span><span class="entity"><span>str</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>length</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>var</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"_"</span></span><span>
         </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>var</span></span><span> </span><span>^</span><span> </span><span>string_of_int</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>index</span></span><span> </span><span>+</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"_"</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>wrap_new_scope</span></span><span> </span><span class="entity"><span>term</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>block_enclose</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"{"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"};"</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>term</span></span><span class="main"><span>]</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>type_of_primitive_pattern</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>destructor</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>fst</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Code_Thingol.unfold_app</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
          </span><span class="entity"><span>IConst</span></span><span> </span><span class="entity"><span>const</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>const</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>extras</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>drop</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>args_num</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>sym </span><span class="entity"><span>destructor</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>dom </span><span class="entity"><span>destructor</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>extras</span></span><span> </span><span class="entity"><span>`--&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>range </span><span class="entity"><span>destructor</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_app_expr</span></span><span> </span><span class="entity"><span>const_syntax</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span>
        </span><span class="main"><span>(</span></span><span class="entity"><span>app</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>{</span></span><span> </span><span class="entity"><span>sym</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>dicts</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>dom</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>range</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>typargs</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span> </span><span class="main"><span>}</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ts</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>k</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>length</span><span> </span><span class="entity"><span>dom</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>l</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>args_num</span></span><span> </span><span class="entity"><span>sym</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>length</span><span> </span><span class="entity"><span>ts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>k</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>is_constr</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>is_constr</span></span><span> </span><span class="entity"><span>sym</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>is_sum_type</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>is_sum_type</span></span><span> </span><span class="entity"><span>sym</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>is_class_param</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>is_class_param</span></span><span> </span><span class="entity"><span>sym</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>dict_args</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print_dict</span></span><span> </span><span class="entity"><span>tyvars</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="entity"><span>dicts</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>typ</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>snd</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Code_Thingol.unfold_fun</span></span><span> </span><span class="entity"><span>range</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
            </span><span class="entity"><span>name</span></span><span> </span><span class="entity"><span>`%%</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>name</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>ITyVar</span></span><span> </span><span class="entity"><span>name</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>name</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>allowed_infinite</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>List.exists</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>typ</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>infinite_types</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span> </span><span class="entity"><span>is_constr</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_class_param</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span> </span><span>not</span><span> </span><span class="main"><span>(</span></span><span>length</span><span> </span><span class="entity"><span>dict_args</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>warning</span><span> </span><span class="inner_quoted"><span>"bug in print_app"</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>applify'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_constr</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>gen_applify</span></span><span> </span><span>true</span><span> </span><span class="inner_quoted"><span>"{"</span></span><span> </span><span class="inner_quoted"><span>"}"</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>gen_applify</span></span><span> </span><span>true</span><span> </span><span class="inner_quoted"><span>"("</span></span><span> </span><span class="inner_quoted"><span>")"</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>immediate</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>curried</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>chop</span><span> </span><span class="entity"><span>l</span></span><span> </span><span class="entity"><span>ts</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>symbol</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_constr</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_sum_type</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span class="entity"><span>allowed_infinite</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>sym</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>Type_Constructor</span></span><span> </span><span class="entity"><span>typ</span></span><span class="main"><span>)</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>sym</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>func_name</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_class_param</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>Pretty.block</span><span> </span><span class="main"><span>[</span></span><span>hd</span><span> </span><span class="entity"><span>dict_args</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"."</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>deresolve</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>symbol</span></span><span class="main"><span>]</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>deresolve</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>symbol</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>wrap_type_args</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_sum_type</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span class="entity"><span>allowed_infinite</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>applify</span></span><span> </span><span class="inner_quoted"><span>"("</span></span><span> </span><span class="inner_quoted"><span>")"</span></span><span> </span><span>I</span><span> </span><span class="entity"><span>APP</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>apply_constraints</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>deresolve_tyco</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>typ</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>typargs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>s</span></span><span class="main"><span>]</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>s</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>wrap_type_conversion</span></span><span> </span><span class="entity"><span>name</span></span><span> </span><span class="main"><span>=</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>typargs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_constr</span></span><span>
                </span><span class="comment1"><span>(* these typargs are always the same set as the outer ones, but sometimes in different order *)</span></span><span>
                </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>range</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="entity"><span>`%%</span></span><span> </span><span class="entity"><span>typargs</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>typargs</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
                </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>typargs</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_class_param</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>name</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>apply_constraints</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>name</span></span><span> </span><span class="entity"><span>typargs</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>immediate_args</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>immediate</span></span><span>
           </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print_go_expr</span></span><span> </span><span class="entity"><span>const_syntax</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>BR</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>invocation</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_class_param</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span class="entity"><span>is_constr</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>immediate_args</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>dict_args</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>immediate_args</span></span><span class="main"><span>)</span></span><span>
           </span><span>|&gt;</span><span> </span><span class="entity"><span>applify'</span></span><span> </span><span>I</span><span> </span><span class="entity"><span>APP</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>wrap_type_conversion</span></span><span> </span><span class="entity"><span>func_name</span></span><span class="main"><span>)</span></span><span>
           </span><span>|&gt;</span><span> </span><span class="entity"><span>wrap_type_args</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>curried_args</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>curried</span></span><span>
           </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>enclose</span></span><span> </span><span class="inner_quoted"><span>"("</span></span><span> </span><span class="inner_quoted"><span>")"</span></span><span> </span><span>o</span><span> </span><span>single</span><span> </span><span>o</span><span> </span><span class="entity"><span>print_go_expr</span></span><span> </span><span class="entity"><span>const_syntax</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>NOBR</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>invocation</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>curried_args</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
       </span><span class="main"><span>[</span></span><span class="entity"><span>print_go_expr</span></span><span> </span><span class="entity"><span>const_syntax</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>BR</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Code_Thingol.saturated_application</span></span><span> </span><span class="entity"><span>k</span></span><span> </span><span class="entity"><span>app</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity"><span>print_clause</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span>Fail</span><span> </span><span class="inner_quoted"><span>"there's a bug in the pattern-match translator"</span></span><span>
    </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>print_clause</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>p</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>target</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pattern</span></span><span class="main"><span>)</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>subps</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>term</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_condition</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>conds</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>constr</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>typargs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>range</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>args</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>p</span></span><span> </span><span class="entity"><span>q</span></span><span> </span><span class="entity"><span>target</span></span><span> </span><span class="entity"><span>body</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>destructor</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_dest_name</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>deresolve</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>constr</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tyco</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>typargs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>snd</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Code_Thingol.unfold_fun</span></span><span> </span><span class="entity"><span>range</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
            </span><span class="entity"><span>a</span></span><span> </span><span class="entity"><span>`%%</span></span><span> </span><span class="entity"><span>typargs</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>a</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>typargs</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>is_boxed</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>is_sum_type</span></span><span> </span><span class="entity"><span>constr</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span>List.exists</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>tyco</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>infinite_types</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>names</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span class="entity"><span>n</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>lookup_var</span></span><span> </span><span class="entity"><span>vars</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"_"</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>args</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>any_names</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>exists</span><span> </span><span>is_some</span><span> </span><span class="entity"><span>args</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>checks</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>conds</span></span><span>
            </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>var</span></span><span class="main"><span>,</span></span><span class="entity"><span>const</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>concat</span></span><span> </span><span class="main"><span>[</span></span><span>
                 </span><span class="entity"><span>str</span></span><span> </span><span class="entity"><span>var</span></span><span class="main"><span>,</span></span><span>
                 </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"=="</span></span><span class="main"><span>,</span></span><span>
                 </span><span class="entity"><span>enclose</span></span><span> </span><span class="inner_quoted"><span>"("</span></span><span> </span><span class="inner_quoted"><span>")"</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>print_app</span></span><span> </span><span>false</span><span> </span><span class="entity"><span>const_syntax</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>NOBR</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>const</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span>
               </span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
            </span><span>|&gt;</span><span> </span><span>separate</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"&amp;&amp;"</span></span><span class="main"><span>)</span></span><span>
            </span><span>|&gt;</span><span> </span><span class="entity"><span>concat</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>Pretty.chunks</span><span>
           </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_boxed</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>oneline</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>block</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>commas</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>str</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>any_names</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>q</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="inner_quoted"><span>"_"</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>":="</span></span><span class="main"><span>,</span></span><span> 
              </span><span class="entity"><span>applify</span></span><span> </span><span class="inner_quoted"><span>".("</span></span><span> </span><span class="inner_quoted"><span>")"</span></span><span> </span><span>I</span><span> </span><span class="entity"><span>NOBR</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span class="entity"><span>target</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>apply_constraints</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>deresolve</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>constr</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>typargs</span></span><span class="main"><span>]</span></span><span class="main"><span>]</span></span><span class="main"><span>]</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>oneline</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"_ ="</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="entity"><span>target</span></span><span class="main"><span>]</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
          </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_boxed</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>block_enclose</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>spaced</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"if"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"{"</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"}"</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>Pretty.chunks</span><span class="main"><span>)</span></span><span>
              </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>any_names</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>oneline</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>Pretty.block</span><span> </span><span>o</span><span> </span><span class="entity"><span>commas</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>names</span></span><span> </span><span>::</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>":="</span></span><span class="main"><span>,</span></span><span>  </span><span class="entity"><span>applify</span></span><span> </span><span class="inner_quoted"><span>"("</span></span><span> </span><span class="inner_quoted"><span>")"</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="entity"><span>NOBR</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span class="entity"><span>destructor</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_boxed</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>q</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>target</span></span><span class="main"><span>]</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span>
                </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
               </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>null</span><span> </span><span class="entity"><span>conds</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>Pretty.chunks</span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>block_enclose</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>spaced</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"if"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>checks</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"{"</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"}"</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                   </span><span class="main"><span>[</span></span><span class="entity"><span>body</span></span><span class="main"><span>]</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>pattern</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span class="entity"><span>IConst</span></span><span> </span><span class="entity"><span>c</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>checks</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>concat</span></span><span>
              </span><span class="main"><span>[</span></span><span class="entity"><span>str</span></span><span> </span><span class="entity"><span>target</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"=="</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>enclose</span></span><span> </span><span class="inner_quoted"><span>"("</span></span><span> </span><span class="inner_quoted"><span>")"</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>print_app</span></span><span> </span><span>false</span><span> </span><span class="entity"><span>const_syntax</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>NOBR</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>c</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>]</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>body</span></span><span> </span><span class="main"><span>=</span></span><span>  </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>subps</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>print_go_term</span></span><span> </span><span class="entity"><span>const_syntax</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>NOBR</span></span><span> </span><span class="entity"><span>term</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>print_clause</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>p</span></span><span> </span><span class="entity"><span>subps</span></span><span> </span><span class="entity"><span>term</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>block_enclose</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>spaced</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"if"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>checks</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"{"</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"}"</span></span><span class="main"><span>)</span></span><span>
               </span><span class="main"><span>[</span></span><span class="entity"><span>body</span></span><span class="main"><span>]</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="entity"><span>`$</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>Code_Thingol.unfold_const_app</span></span><span> </span><span class="entity"><span>pattern</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
            </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span>Fail</span><span> </span><span class="inner_quoted"><span>"bad application in pattern match"</span></span><span>
          </span><span class="main"><span>|</span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>constr</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>args</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>arg_names</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>subpatterns</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>conds</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>vars'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span>fold_rev</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>term</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>ts</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>cs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>vars</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>term</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
                  </span><span class="entity"><span>IConst</span></span><span> </span><span class="entity"><span>c</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
                  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>name</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Name.invent</span><span> </span><span class="main"><span>(</span></span><span>snd</span><span> </span><span class="entity"><span>vars</span></span><span class="main"><span>)</span></span><span> </span><span class="inner_quoted"><span>"c"</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span>
                  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span class="entity"><span>name</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>ts</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rs</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="entity"><span>name</span></span><span class="main"><span>,</span></span><span class="entity"><span>c</span></span><span class="main"><span>)</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>cs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>intro_vars</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>name</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>vars</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
                </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>IVar</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>NONE</span><span> </span><span>::</span><span> </span><span class="entity"><span>ts</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>cs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>vars</span></span><span class="main"><span>)</span></span><span>
                </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>IVar</span></span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span class="entity"><span>v</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span class="entity"><span>v</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>ts</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>cs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>intro_vars</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>v</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>vars</span></span><span class="main"><span>)</span></span><span>
                </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="entity"><span>`$</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
                  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>name</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Name.invent</span><span> </span><span class="main"><span>(</span></span><span>snd</span><span> </span><span class="entity"><span>vars</span></span><span class="main"><span>)</span></span><span> </span><span class="inner_quoted"><span>"p"</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span>
                  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span class="entity"><span>name</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>ts</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>name</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>term</span></span><span class="main"><span>)</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>rs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>cs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>intro_vars</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>name</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>vars</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>)</span></span><span>
              </span><span class="entity"><span>args</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>vars</span></span><span class="main"><span>)</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>q</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Name.invent</span><span> </span><span class="main"><span>(</span></span><span>snd</span><span> </span><span class="entity"><span>vars</span></span><span class="main"><span>)</span></span><span> </span><span class="inner_quoted"><span>"q"</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>intro_vars</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>q</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>vars</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>wrapper</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>print_condition</span></span><span> </span><span class="entity"><span>vars'</span></span><span> </span><span class="entity"><span>conds</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>sym </span><span class="entity"><span>constr</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>#</span></span><span>typargs </span><span class="entity"><span>constr</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>#</span></span><span>range </span><span class="entity"><span>constr</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>arg_names</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>p</span></span><span> </span><span class="entity"><span>q</span></span><span> </span><span class="entity"><span>target</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>subpatterns'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>subpatterns</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>subps</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>wrapper</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>subpatterns'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>print_go_term</span></span><span> </span><span class="entity"><span>const_syntax</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars'</span></span><span> </span><span class="entity"><span>NOBR</span></span><span> </span><span class="entity"><span>term</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>print_clause</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars'</span></span><span> </span><span class="entity"><span>p</span></span><span> </span><span class="entity"><span>subpatterns'</span></span><span> </span><span class="entity"><span>term</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>IVar</span></span><span> </span><span class="entity"><span>v</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>vars'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>intro_vars</span></span><span> </span><span class="main"><span>(</span></span><span>the_list</span><span> </span><span class="entity"><span>v</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>vars</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>name_printed</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>v</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
              </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"_"</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>name</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>lookup_var</span></span><span> </span><span class="entity"><span>vars'</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>name</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>binding</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>oneline</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>name_printed</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>":="</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="entity"><span>target</span></span><span class="main"><span>]</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>usage</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>v</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
                </span><span>SOME</span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>oneline</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"_ ="</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>name_printed</span></span><span class="main"><span>]</span></span><span>
              </span><span class="main"><span>|</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>""</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>body</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>subps</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>print_go_term</span></span><span> </span><span class="entity"><span>const_syntax</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars'</span></span><span> </span><span class="entity"><span>NOBR</span></span><span> </span><span class="entity"><span>term</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>print_clause</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars'</span></span><span> </span><span class="entity"><span>p</span></span><span> </span><span class="entity"><span>subps</span></span><span> </span><span class="entity"><span>term</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span>Pretty.chunks</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>binding</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>body</span></span><span class="main"><span>]</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span>Fail</span><span> </span><span class="inner_quoted"><span>"bad term in pattern"</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity"><span>print_pattern_match</span></span><span> </span><span class="entity"><span>is_stmt</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>rtyp</span></span><span> </span><span class="entity"><span>target</span></span><span> </span><span class="entity"><span>clauses</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>target_var</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Name.invent</span><span> </span><span class="main"><span>(</span></span><span>snd</span><span> </span><span class="entity"><span>vars</span></span><span class="main"><span>)</span></span><span> </span><span class="inner_quoted"><span>"target"</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>intro_vars</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>target_var</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>vars</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>p</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Name.invent</span><span> </span><span class="main"><span>(</span></span><span>snd</span><span> </span><span class="entity"><span>vars</span></span><span class="main"><span>)</span></span><span> </span><span class="inner_quoted"><span>"m"</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>intro_vars</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>p</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>vars</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>target</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>print_go_expr</span></span><span> </span><span class="entity"><span>const_syntax</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>NOBR</span></span><span> </span><span class="entity"><span>target</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>assignment</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>oneline</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>str</span></span><span> </span><span class="entity"><span>target_var</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>":="</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>target</span></span><span class="main"><span>]</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>body</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>assignment</span></span><span>
           </span><span>::</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>pattern</span></span><span class="main"><span>,</span></span><span class="entity"><span>term</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
               </span><span class="entity"><span>wrap_new_scope</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print_clause</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>p</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>target_var</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pattern</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>term</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
           </span><span class="entity"><span>clauses</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>oneline</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"panic(\"match failed\")"</span></span><span class="main"><span>]</span></span><span class="main"><span>]</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_stmt</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>Pretty.chunks</span><span> </span><span class="entity"><span>body</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>wrap_into_lambda</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>rtyp</span></span><span> </span><span class="entity"><span>body</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity"><span>print_app</span></span><span> </span><span class="entity"><span>is_stmt</span></span><span> </span><span class="entity"><span>const_syntax</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>app</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>const</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>args</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>List.exists</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>name</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>#</span></span><span>sym </span><span class="entity"><span>const</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Constant</span></span><span> </span><span class="entity"><span>name</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>undefineds</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
         </span><span class="entity"><span>args</span></span><span>
          </span><span class="comment1"><span>(* the arguments may use otherwise-unused variables, so just print somewhere to make Go happy *)</span></span><span>
          </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print_go_expr</span></span><span> </span><span class="entity"><span>const_syntax</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>fxy</span></span><span class="main"><span>)</span></span><span>
          </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>p</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>oneline</span></span><span> </span><span class="main"><span>[</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"_ = "</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
          </span><span>|&gt;</span><span> </span><span>curry</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>@</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"panic(\"encountered undefined function: \" + "</span></span><span>^</span><span class="entity"><span>print_go_string</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Code_Symbol.default_base</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>sym </span><span class="entity"><span>const</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>^</span><span class="inner_quoted"><span>")"</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>]</span></span><span>
          </span><span>|&gt;</span><span> </span><span>Pretty.chunks</span><span>
       </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>wrap_if</span></span><span> </span><span class="entity"><span>is_stmt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>gen_print_app</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print_app_expr</span></span><span> </span><span class="entity"><span>const_syntax</span></span><span> </span><span class="entity"><span>tyvars</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>(</span></span><span class="entity"><span>print_go_expr</span></span><span> </span><span class="entity"><span>const_syntax</span></span><span> </span><span class="entity"><span>tyvars</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>const_syntax</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="entity"><span>app</span></span><span class="main"><span>)</span></span><span>
    </span><span class="comment1"><span>(* go has a distinction between expressions and statements which Thingol doesn't, so we just
       periodically have to wrap things into a lambda &amp; return *)</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity"><span>print_go_term</span></span><span> </span><span class="entity"><span>const_syntax</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="entity"><span>iterm</span></span><span> </span><span class="main"><span>=</span></span><span>
        </span><span class="entity"><span>print_go_term_gen</span></span><span> </span><span>true</span><span> </span><span class="entity"><span>const_syntax</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="entity"><span>iterm</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity"><span>print_go_expr</span></span><span> </span><span class="entity"><span>const_syntax</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span>
        </span><span class="entity"><span>print_go_term_gen</span></span><span> </span><span>false</span><span> </span><span class="entity"><span>const_syntax</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="entity"><span>t</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity"><span>print_go_term_gen</span></span><span> </span><span class="entity"><span>is_stmt</span></span><span> </span><span class="entity"><span>const_syntax</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
      </span><span class="entity"><span>IConst</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>const</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>{</span></span><span class="entity"><span>sym</span></span><span class="main"><span>,</span></span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print_app</span></span><span> </span><span class="entity"><span>is_stmt</span></span><span> </span><span class="entity"><span>const_syntax</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>const</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
    </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>t1</span></span><span> </span><span class="entity"><span>`$</span></span><span> </span><span class="entity"><span>t2</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>Code_Thingol.unfold_const_app</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
         </span><span>SOME</span><span> </span><span class="entity"><span>app</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="main"><span>(</span></span><span class="entity"><span>print_app</span></span><span> </span><span class="entity"><span>is_stmt</span></span><span> </span><span class="entity"><span>const_syntax</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="entity"><span>app</span></span><span class="main"><span>)</span></span><span>
       </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>wrap_if</span></span><span> </span><span class="entity"><span>is_stmt</span></span><span>
            </span><span class="main"><span>(</span></span><span class="entity"><span>applify</span></span><span> </span><span class="inner_quoted"><span>"("</span></span><span> </span><span class="inner_quoted"><span>")"</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print_go_expr</span></span><span> </span><span class="entity"><span>const_syntax</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>NOBR</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>fxy</span></span><span>
                    </span><span class="main"><span>(</span></span><span class="entity"><span>print_go_expr</span></span><span> </span><span class="entity"><span>const_syntax</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>BR</span></span><span> </span><span class="entity"><span>t1</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>t2</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
    </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>IVar</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span>Fail</span><span> </span><span class="inner_quoted"><span>"can't return a variable with no name!"</span></span><span>
    </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>IVar</span></span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span class="entity"><span>v</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>wrap_if</span></span><span> </span><span class="entity"><span>is_stmt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>lookup_var</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>v</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
    </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>params</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tys</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>`|=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rty</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="comment1"><span>(* horrible workaround, please fix me upstream *)</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rty</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
           </span><span class="entity"><span>ICase</span></span><span> </span><span class="entity"><span>c</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>type_of_primitive_pattern</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>primitive </span><span class="entity"><span>c</span></span><span class="main"><span>)</span></span><span>
           </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>rty</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>vars'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>intro_vars</span></span><span> </span><span class="main"><span>(</span></span><span>map_filter</span><span> </span><span>I</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>params</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>vars</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>func_head</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>print_func_head</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>vars'</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>params</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>tys</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print_go_typ</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>rty</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>body</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>print_go_term</span></span><span> </span><span class="entity"><span>const_syntax</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars'</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="entity"><span>t</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>wrap_if</span></span><span> </span><span class="entity"><span>is_stmt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print_func</span></span><span> </span><span class="entity"><span>func_head</span></span><span> </span><span class="entity"><span>body</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
    </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>ICase</span></span><span> </span><span class="main"><span>{</span></span><span> clauses </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span> </span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>warning</span><span> </span><span class="inner_quoted"><span>"empty case statement; generating call to panic() ..."</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"panic(\"empty case\");"</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
    </span><span class="comment1"><span>(* this is a let-binding, represented as a case *)</span></span><span>
    </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>ICase</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>cases</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>{</span></span><span> clauses </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>_</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>binds</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>body</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Code_Thingol.unfold_let</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ICase</span></span><span> </span><span class="entity"><span>cases</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>does_not_pattern_match</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>List.all</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Code_Thingol.is_IVar</span></span><span> </span><span>o</span><span> </span><span>fst</span><span> </span><span>o</span><span> </span><span>fst</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>binds</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>does_not_pattern_match</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_call</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>=</span></span><span>
            </span><span class="main"><span>(</span></span><span class="entity"><span>print_go_expr</span></span><span> </span><span class="entity"><span>const_syntax</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>vars</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_bind</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="entity"><span>p</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="entity"><span>gen_print_bind</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print_go_expr</span></span><span> </span><span class="entity"><span>const_syntax</span></span><span> </span><span class="entity"><span>tyvars</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="entity"><span>p</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_assignment</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>pat</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>vars</span></span><span>
            </span><span>|&gt;</span><span> </span><span class="entity"><span>print_bind</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>BR</span></span><span> </span><span class="entity"><span>pat</span></span><span>
            </span><span>|&gt;&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>p</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>oneline</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>p</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>":="</span></span><span class="main"><span>,</span></span><span>
                  </span><span>fst</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print_call</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="entity"><span>vars</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_left</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>IVar</span></span><span> </span><span>NONE</span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
            </span><span class="entity"><span>print_call</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="comment1"><span>(* evaluate and discard the result; go does not allow declaring to blank *)</span></span><span>
          </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>print_left</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>pat</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="entity"><span>IVar</span></span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
            </span><span class="entity"><span>print_assignment</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>pat</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>seps_ps</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>vars'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
            </span><span>fold_map</span><span> </span><span class="entity"><span>print_left</span></span><span> </span><span class="entity"><span>binds</span></span><span> </span><span class="entity"><span>vars</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>term</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>print_go_term</span></span><span> </span><span class="entity"><span>const_syntax</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars'</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="entity"><span>body</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_stmt</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>Pretty.chunks</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>seps_ps</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>term</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>wrap_into_lambda</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>type_of_primitive_pattern</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>primitive </span><span class="entity"><span>cases</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>seps_ps</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>term</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
       </span><span class="entity"><span>print_pattern_match</span></span><span> </span><span class="entity"><span>is_stmt</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span>
         </span><span class="main"><span>(</span></span><span class="entity"><span>type_of_primitive_pattern</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>primitive </span><span class="entity"><span>cases</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>term </span><span class="entity"><span>cases</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>clauses </span><span class="entity"><span>cases</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
    </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>ICase</span></span><span> </span><span class="entity"><span>cases</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>print_pattern_match</span></span><span> </span><span class="entity"><span>is_stmt</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span>
         </span><span class="main"><span>(</span></span><span class="entity"><span>type_of_primitive_pattern</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>primitive </span><span class="entity"><span>cases</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>term </span><span class="entity"><span>cases</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>clauses </span><span class="entity"><span>cases</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_dict_args</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_single_arg</span></span><span> </span><span class="entity"><span>length</span></span><span> </span><span class="entity"><span>v</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>index</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>class</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>name</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>length</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>v</span></span><span>^</span><span class="inner_quoted"><span>"_"</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>v</span></span><span> </span><span>^</span><span> </span><span>string_of_int</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>index</span></span><span> </span><span>+</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"_"</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ty</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>apply_constraints</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>deresolve_class</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>class</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>ITyVar</span></span><span> </span><span class="entity"><span>v</span></span><span class="main"><span>]</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>concat</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>str</span></span><span> </span><span class="entity"><span>name</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>]</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_single_dict</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>v</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sort</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>args</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map_index</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print_single_arg</span></span><span> </span><span class="main"><span>(</span></span><span>length</span><span> </span><span class="entity"><span>sort</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>v</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>sort</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>args</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>print_single_dict</span></span><span> </span><span class="entity"><span>vs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>


    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_go_func</span></span><span> </span><span class="entity"><span>const_syntax</span></span><span> </span><span class="entity"><span>reserved</span></span><span> </span><span class="entity"><span>const</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>ty</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tys</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Code_Thingol.unfold_fun</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>params</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Name.invent</span><span> </span><span class="main"><span>(</span></span><span>snd</span><span> </span><span class="entity"><span>reserved</span></span><span class="main"><span>)</span></span><span> </span><span class="inner_quoted"><span>"a"</span></span><span> </span><span class="main"><span>(</span></span><span>length</span><span> </span><span class="entity"><span>tys</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>intro_tyvars</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>reserved</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>intro_vars</span></span><span> </span><span class="entity"><span>params</span></span><span> </span><span class="entity"><span>tyvars</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>dict_args</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>print_dict_args</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>vs</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>head</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>print_func_head</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span>o</span><span> </span><span class="entity"><span>Constant</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>const</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>fst</span><span> </span><span class="entity"><span>vs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>dict_args</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>SOME</span><span> </span><span class="entity"><span>params</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>tys</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print_go_typ</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>ty'</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>warning</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"you appear to have defined a function "</span></span><span>^</span><span class="entity"><span>const</span></span><span>^</span><span class="inner_quoted"><span>" with no body; generating a call to panic() ..."</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="entity"><span>print_func</span></span><span> </span><span class="entity"><span>head</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>oneline</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>str</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"panic("</span></span><span>^</span><span class="entity"><span>print_go_string</span></span><span> </span><span class="entity"><span>const</span></span><span>^</span><span class="inner_quoted"><span>")"</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
    </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>print_go_func</span></span><span> </span><span class="entity"><span>const_syntax</span></span><span> </span><span class="entity"><span>reserved</span></span><span> </span><span class="entity"><span>const</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>ty</span></span><span> </span><span class="entity"><span>eqs</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tycos</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>build</span><span> </span><span class="main"><span>(</span></span><span>fold</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>ts</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span>fold</span><span> </span><span class="entity"><span>Code_Thingol.add_tyconames</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>ts</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>eqs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>reserved</span></span><span>
          </span><span>|&gt;</span><span> </span><span class="entity"><span>intro_base_names</span></span><span>
               </span><span class="main"><span>(</span></span><span>is_none</span><span> </span><span>o</span><span> </span><span class="entity"><span>tyco_syntax</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>deresolve_tyco</span></span><span> </span><span class="entity"><span>tycos</span></span><span>
          </span><span>|&gt;</span><span> </span><span class="entity"><span>intro_tyvars</span></span><span> </span><span class="entity"><span>vs</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>simple</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>eqs</span></span><span>
         </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>ts</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>forall</span><span> </span><span class="entity"><span>Code_Thingol.is_IVar</span></span><span> </span><span class="entity"><span>ts</span></span><span>
          </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>false</span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>vars1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>reserved</span></span><span>
          </span><span>|&gt;</span><span> </span><span class="entity"><span>intro_tyvars</span></span><span> </span><span class="entity"><span>vs</span></span><span>
          </span><span>|&gt;</span><span> </span><span class="entity"><span>intro_base_names_for</span></span><span> </span><span class="main"><span>(</span></span><span>is_none</span><span> </span><span>o</span><span> </span><span class="entity"><span>const_syntax</span></span><span class="main"><span>)</span></span><span>
               </span><span class="entity"><span>deresolve</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>snd</span><span> </span><span>o</span><span> </span><span>fst</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>eqs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>params</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>simple</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>IVar</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span>o</span><span> </span><span>fst</span><span> </span><span>o</span><span> </span><span>fst</span><span> </span><span>o</span><span> </span><span>hd</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>eqs</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>map</span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>aux_params</span></span><span> </span><span class="entity"><span>vars1</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span>o</span><span> </span><span>fst</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>eqs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>vars2</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>intro_vars</span></span><span> </span><span class="main"><span>(</span></span><span>map_filter</span><span> </span><span>I</span><span> </span><span class="entity"><span>params</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>vars1</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tys'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Code_Thingol.unfold_fun_n</span></span><span> </span><span class="main"><span>(</span></span><span>length</span><span> </span><span class="entity"><span>params</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_rhs</span></span><span> </span><span class="entity"><span>is_stmt</span></span><span> </span><span class="entity"><span>vars'</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>some_thm</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="entity"><span>print_go_term_gen</span></span><span> </span><span class="entity"><span>is_stmt</span></span><span> </span><span class="entity"><span>const_syntax</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars'</span></span><span> </span><span class="entity"><span>NOBR</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>p</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Name.invent</span><span> </span><span class="main"><span>(</span></span><span>snd</span><span> </span><span class="entity"><span>vars2</span></span><span class="main"><span>)</span></span><span> </span><span class="inner_quoted"><span>"m"</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>vars3</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>intro_vars</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>p</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>vars2</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_fun_clause</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>targets</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>some_thm</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>used</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Code_Thingol.add_varnames</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>vars'</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="entity"><span>intro_vars</span></span><span> </span><span class="main"><span>(</span></span><span>build</span><span> </span><span class="main"><span>(</span></span><span>fold</span><span> </span><span class="entity"><span>Code_Thingol.add_varnames</span></span><span> </span><span class="entity"><span>targets</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>vars2</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>remove_unused</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>IVar</span></span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span class="entity"><span>name</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>IVar</span></span><span>
                </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>member</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>used</span></span><span> </span><span class="entity"><span>name</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>name</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span>
              </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>remove_unused</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>t</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>clauses</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>params</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>targets</span></span><span>
              </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>apsnd</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>map_terms_bottom_up</span></span><span> </span><span class="entity"><span>remove_unused</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
              </span><span>|&gt;</span><span> </span><span>filter</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>IVar</span></span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>false</span><span> </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>true</span><span class="main"><span>)</span></span><span>
              </span><span>|&gt;</span><span> </span><span>map_filter</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span>NONE</span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span class="entity"><span>v</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>v</span></span><span class="main"><span>,</span></span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>clause</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>print_clause</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars'</span></span><span> </span><span class="entity"><span>p</span></span><span> </span><span class="entity"><span>clauses</span></span><span> </span><span class="entity"><span>t</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span class="entity"><span>wrap_new_scope</span></span><span> </span><span class="entity"><span>clause</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>dict_args</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>print_dict_args</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>vs</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>head</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>print_func_head</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>vars3</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span>o</span><span> </span><span class="entity"><span>Constant</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>const</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>fst</span><span> </span><span class="entity"><span>vs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>dict_args</span></span><span> </span><span class="entity"><span>params</span></span><span> </span><span class="entity"><span>tys'</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print_go_typ</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>ty'</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="comment1"><span>(*if null params andalso null vs then
         print_var ((str o deresolve_const) const) (print_rhs false vars2 (hd eqs))
       else*)</span></span><span>
       </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>simple</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
          </span><span class="entity"><span>print_func</span></span><span> </span><span class="entity"><span>head</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print_rhs</span></span><span> </span><span>true</span><span> </span><span class="entity"><span>vars2</span></span><span> </span><span class="main"><span>(</span></span><span>hd</span><span> </span><span class="entity"><span>eqs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
          </span><span class="entity"><span>print_func</span></span><span> </span><span class="entity"><span>head</span></span><span> </span><span class="main"><span>(</span></span><span>Pretty.chunks</span><span>
            </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>print_fun_clause</span></span><span> </span><span class="entity"><span>eqs</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>oneline</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"panic(\"match failed\")"</span></span><span class="main"><span>]</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_typeclass</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>sym</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>target</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>super</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>params</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>intro_vars</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>target</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>tyvars</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>super_fields</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>super</span></span><span>
          </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>self</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>super</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>block</span></span><span> </span><span class="main"><span>[</span></span><span>
               </span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span>o</span><span> </span><span>Long_Name.base_name</span><span> </span><span>o</span><span> </span><span class="entity"><span>deresolve_classrel</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>self</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>super</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
               </span><span>Pretty.brk</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>,</span></span><span>
               </span><span class="entity"><span>apply_constraints</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>deresolve_class</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>super</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>ITyVar</span></span><span> </span><span class="entity"><span>target</span></span><span class="main"><span>]</span></span><span>
             </span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>fields</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>params</span></span><span>
          </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>name</span></span><span class="main"><span>,</span></span><span class="entity"><span>typ</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>block</span></span><span> </span><span class="main"><span>[</span></span><span>
               </span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>deresolve_const</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>name</span></span><span class="main"><span>,</span></span><span> </span><span>Pretty.brk</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>,</span></span><span>
               </span><span class="entity"><span>print_go_typ_uncurried_toplevel</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>typ</span></span><span>
             </span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
          </span><span>|&gt;</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>@</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>super_fields</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>head</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>applify_constraints</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>deresolve_class</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>sym</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>target</span></span><span class="main"><span>]</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>block_enclose</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>concat</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"type"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>head</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"struct {"</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"}"</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>fields</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_instance</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>target</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>class</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>{</span></span><span class="entity"><span>vs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>inst_params</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>superinsts</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tyco</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>class_name</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>deresolve_class</span></span><span> </span><span class="entity"><span>class</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>intro_tyvars</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>tyvars</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tyargs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span>fst</span><span> </span><span class="entity"><span>vs</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>class_head</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>apply_constraints</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span class="entity"><span>class_name</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>tyco</span></span><span> </span><span class="entity"><span>`%%</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>ITyVar</span></span><span> </span><span class="entity"><span>tyargs</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>sym</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Class_Instance</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>target</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>class</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>instance_name</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>deresolve_inst</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>target</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>class</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>superinsts_fields</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>superinsts</span></span><span>
          </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>super</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>dicts</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>block</span></span><span> </span><span class="main"><span>[</span></span><span>
              </span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span>o</span><span> </span><span>Long_Name.base_name</span><span> </span><span>o</span><span> </span><span class="entity"><span>deresolve_classrel</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>class</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>super</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
              </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>":"</span></span><span class="main"><span>,</span></span><span> </span><span>Pretty.brk</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>,</span></span><span>
              </span><span class="entity"><span>print_dict</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Dict</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Dict_Const</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>tyco</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>super</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>dicts</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>","</span></span><span>
            </span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
         </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_classparam_instance</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>classparam</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>const</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>{</span></span><span> </span><span class="entity"><span>dom</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span> </span><span class="main"><span>}</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>dom_length</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>thm</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
           </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
             </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>aux_dom</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Name.invent_names</span><span> </span><span class="main"><span>(</span></span><span>snd</span><span> </span><span class="entity"><span>reserved</span></span><span class="main"><span>)</span></span><span> </span><span class="inner_quoted"><span>"A"</span></span><span> </span><span class="entity"><span>dom</span></span><span class="main"><span>;</span></span><span>
             </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>auxs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span>fst</span><span> </span><span class="entity"><span>aux_dom</span></span><span class="main"><span>;</span></span><span>
             </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>intro_vars</span></span><span> </span><span class="entity"><span>auxs</span></span><span> </span><span class="entity"><span>tyvars</span></span><span class="main"><span>;</span></span><span>
             </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>aux_dom1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>aux_dom2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>chop</span><span> </span><span class="entity"><span>dom_length</span></span><span> </span><span class="entity"><span>aux_dom</span></span><span class="main"><span>;</span></span><span>
             </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>abstract_using</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="entity"><span>body</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>body</span></span><span>
               </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>abstract_using</span></span><span> </span><span class="entity"><span>aux_dom</span></span><span> </span><span class="entity"><span>should_wrap</span></span><span> </span><span class="entity"><span>rty</span></span><span> </span><span class="entity"><span>body</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
                  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>params</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>aux_dom</span></span><span>
                   </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>aux</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                       </span><span class="entity"><span>block</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>lookup_var</span></span><span> </span><span class="entity"><span>vars</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>aux</span></span><span class="main"><span>,</span></span><span> </span><span>Pretty.brk</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>print_go_typ</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
                  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>head</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>print_func_head</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>params</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
                       </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>should_wrap</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>print_go_typ_uncurried_toplevel</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>print_go_typ</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>rty</span></span><span class="main"><span>)</span></span><span>
                 </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>print_func</span></span><span> </span><span class="entity"><span>head</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>wrap_if</span></span><span> </span><span class="entity"><span>should_wrap</span></span><span> </span><span class="entity"><span>body</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
             </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>aux_abstract</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>not</span><span> </span><span class="main"><span>(</span></span><span>null</span><span> </span><span class="entity"><span>aux_dom1</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span> </span><span>not</span><span> </span><span class="main"><span>(</span></span><span>null</span><span> </span><span class="entity"><span>aux_dom2</span></span><span class="main"><span>)</span></span><span>
               </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>abstract_using</span></span><span> </span><span class="entity"><span>aux_dom1</span></span><span> </span><span>true</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>snd</span><span> </span><span class="entity"><span>aux_dom2</span></span><span> </span><span class="entity"><span>`--&gt;</span></span><span> </span><span class="main"><span>#</span></span><span>range </span><span class="entity"><span>const</span></span><span class="main"><span>)</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>abstract_using</span></span><span> </span><span class="entity"><span>aux_dom2</span></span><span> </span><span>false</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>range </span><span class="entity"><span>const</span></span><span class="main"><span>)</span></span><span>
               </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>abstract_using</span></span><span> </span><span class="entity"><span>aux_dom1</span></span><span> </span><span>false</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>range </span><span class="entity"><span>const</span></span><span class="main"><span>)</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>abstract_using</span></span><span> </span><span class="entity"><span>aux_dom2</span></span><span> </span><span>false</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>range </span><span class="entity"><span>const</span></span><span class="main"><span>)</span></span><span>
             </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>wrap_in_func</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>null</span><span> </span><span class="entity"><span>aux_dom1</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span> </span><span>null</span><span> </span><span class="entity"><span>aux_dom2</span></span><span>
               </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>print_func</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print_func_head</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print_go_typ</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>range </span><span class="entity"><span>const</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>I</span><span>
             </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>wrap_aux</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="main"><span>(</span></span><span>null</span><span> </span><span class="entity"><span>aux_dom1</span></span><span class="main"><span>,</span></span><span> </span><span>null</span><span> </span><span class="entity"><span>aux_dom2</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
               </span><span class="main"><span>(</span></span><span>true</span><span class="main"><span>,</span></span><span> </span><span>true</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>print_func</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print_func_head</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print_go_typ</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>range </span><span class="entity"><span>const</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
             </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span>false</span><span class="main"><span>,</span></span><span> </span><span>false</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>abstract_using</span></span><span> </span><span class="entity"><span>aux_dom1</span></span><span> </span><span>true</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>snd</span><span> </span><span class="entity"><span>aux_dom2</span></span><span> </span><span class="entity"><span>`--&gt;</span></span><span> </span><span class="main"><span>#</span></span><span>range </span><span class="entity"><span>const</span></span><span class="main"><span>)</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>abstract_using</span></span><span> </span><span class="entity"><span>aux_dom2</span></span><span> </span><span>false</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>range </span><span class="entity"><span>const</span></span><span class="main"><span>)</span></span><span>
             </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>abstract_using</span></span><span> </span><span class="entity"><span>aux_dom1</span></span><span> </span><span>false</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>range </span><span class="entity"><span>const</span></span><span class="main"><span>)</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>abstract_using</span></span><span> </span><span class="entity"><span>aux_dom2</span></span><span> </span><span>false</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>range </span><span class="entity"><span>const</span></span><span class="main"><span>)</span></span><span>
           </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>block</span></span><span> </span><span class="main"><span>[</span></span><span>
            </span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span>o</span><span> </span><span>Long_Name.base_name</span><span> </span><span>o</span><span> </span><span class="entity"><span>deresolve_const</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>classparam</span></span><span class="main"><span>,</span></span><span>
            </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>":"</span></span><span class="main"><span>,</span></span><span> </span><span>Pretty.brk</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>,</span></span><span>
            </span><span class="main"><span>(</span></span><span class="entity"><span>wrap_aux</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>wrap_in_return</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>print_app</span></span><span> </span><span>false</span><span> </span><span class="entity"><span>const_syntax</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span class="entity"><span>thm</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>NOBR</span></span><span class="main"><span>)</span></span><span>
              </span><span class="main"><span>(</span></span><span class="entity"><span>const</span></span><span class="main"><span>,</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>IVar</span></span><span> </span><span>o</span><span> </span><span>SOME</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>auxs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
            </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>","</span></span><span>
           </span><span class="main"><span>]</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>body</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>block_enclose</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>concat</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"return"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>class_head</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"{"</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"}"</span></span><span class="main"><span>)</span></span><span>
                      </span><span class="main"><span>(</span></span><span class="entity"><span>superinsts_fields</span></span><span>
                        </span><span>@</span><span> </span><span>map</span><span> </span><span class="entity"><span>print_classparam_instance</span></span><span> </span><span class="entity"><span>inst_params</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>head</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>print_func_head</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>reserved</span></span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span class="entity"><span>sym</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>tyargs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print_dict_args</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>vs</span></span><span class="main"><span>)</span></span><span>
                   </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>class_head</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>print_func</span></span><span> </span><span class="entity"><span>head</span></span><span> </span><span class="entity"><span>body</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_stmt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Constant</span></span><span> </span><span class="entity"><span>const</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Fun</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>vs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>raw_eqs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
       </span><span class="entity"><span>print_go_func</span></span><span> </span><span class="entity"><span>const_syntax</span></span><span> </span><span class="entity"><span>reserved</span></span><span> </span><span class="entity"><span>const</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>ty</span></span><span> </span><span class="main"><span>(</span></span><span>filter</span><span> </span><span class="main"><span>(</span></span><span>snd</span><span> </span><span>o</span><span> </span><span>snd</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>raw_eqs</span></span><span class="main"><span>)</span></span><span>
    </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>print_stmt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Type_Constructor</span></span><span> </span><span class="entity"><span>tyco</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Datatype</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>vs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>cos</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
       </span><span class="entity"><span>print_go_typedef</span></span><span> </span><span class="entity"><span>tyco</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>cos</span></span><span> </span><span class="entity"><span>reserved</span></span><span>
    </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>print_stmt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Type_Class</span></span><span> </span><span class="entity"><span>sym</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Class</span></span><span> </span><span class="entity"><span>class</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
       </span><span class="entity"><span>print_typeclass</span></span><span> </span><span class="entity"><span>reserved</span></span><span> </span><span class="entity"><span>sym</span></span><span> </span><span class="entity"><span>class</span></span><span>
    </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>print_stmt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Class_Instance</span></span><span> </span><span class="entity"><span>sym</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Instance</span></span><span> </span><span class="entity"><span>instance</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
       </span><span class="entity"><span>print_instance</span></span><span> </span><span class="entity"><span>reserved</span></span><span> </span><span class="entity"><span>sym</span></span><span> </span><span class="entity"><span>instance</span></span><span>
    </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>print_stmt</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"&lt;unknown&gt;"</span></span><span> </span><span class="comment1"><span>(*raise Fail "whatever this is, it's not yet supported";*)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>print_stmt</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>



</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>variant_capitalize</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>cs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Symbol.explode</span><span> </span><span class="entity"><span>s</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>s_lower</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>cs</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
      </span><span class="entity"><span>c</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>cs</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Symbol.to_ascii_upper</span><span> </span><span class="entity"><span>c</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>cs</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
    </span><span>|&gt;</span><span> </span><span>Name.variant</span><span> </span><span class="main"><span>(</span></span><span>implode</span><span> </span><span class="entity"><span>s_lower</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>go_program_of_program</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>module_name</span></span><span> </span><span class="entity"><span>reserved</span></span><span> </span><span class="entity"><span>identifiers</span></span><span> </span><span class="entity"><span>exports</span></span><span> </span><span class="entity"><span>program</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>variant</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>variant_capitalize</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>namify_module</span></span><span> </span><span class="entity"><span>name_fragment</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>nsp_class</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nsp_object</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nsp_common</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>declare</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Name.declare</span><span> </span><span class="entity"><span>name_fragment</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>name_fragment</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>declare</span></span><span> </span><span class="entity"><span>nsp_class</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>declare</span></span><span> </span><span class="entity"><span>nsp_object</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>declare</span></span><span> </span><span class="entity"><span>nsp_common</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>namify_common</span></span><span> </span><span class="entity"><span>base</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>nsp_class</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nsp_object</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nsp_common</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>base'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nsp_common'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>variant</span></span><span> </span><span class="entity"><span>base</span></span><span> </span><span class="entity"><span>nsp_common</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="main"><span>(</span></span><span class="entity"><span>base'</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>Name.declare</span><span> </span><span class="entity"><span>base'</span></span><span> </span><span class="entity"><span>nsp_class</span></span><span class="main"><span>,</span></span><span> </span><span>Name.declare</span><span> </span><span class="entity"><span>base'</span></span><span> </span><span class="entity"><span>nsp_object</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nsp_common'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>namify_stmt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Code_Thingol.Fun</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>namify_common</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>namify_stmt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Code_Thingol.Datatype</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>namify_common</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>namify_stmt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Code_Thingol.Datatypecons</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>namify_common</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>namify_stmt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Code_Thingol.Class</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>namify_common</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>namify_stmt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Code_Thingol.Classrel</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>namify_common</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>namify_stmt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Code_Thingol.Classparam</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>namify_common</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>namify_stmt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Code_Thingol.Classinst</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>namify_common</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>modify_stmt</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Code_Thingol.Fun</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>NONE</span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>modify_stmt</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>export</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Code_Thingol.Fun</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>export</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Fun</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>modify_stmt</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>export</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Code_Thingol.Datatype</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>export</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Datatype</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>modify_stmt</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Code_Thingol.Datatypecons</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>NONE</span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>modify_stmt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Type_Class</span></span><span> </span><span class="entity"><span>class</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>export</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Code_Thingol.Class</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>export</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Class</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>modify_stmt</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Code_Thingol.Classrel</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>NONE</span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>modify_stmt</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Code_Thingol.Classparam</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>NONE</span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>modify_stmt</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>export</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Code_Thingol.Classinst</span></span><span> </span><span class="entity"><span>inst</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>export</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Instance</span></span><span> </span><span class="entity"><span>inst</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="entity"><span>Code_Namespace.hierarchical_program</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
      </span><span class="main"><span>{</span></span><span> module_name </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>module_name</span></span><span class="main"><span>,</span></span><span> reserved </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>reserved</span></span><span class="main"><span>,</span></span><span> identifiers </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>identifiers</span></span><span class="main"><span>,</span></span><span>
        empty_nsp </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>reserved</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>reserved</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>reserved</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> namify_module </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>namify_module</span></span><span class="main"><span>,</span></span><span>
        namify_stmt </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>namify_stmt</span></span><span class="main"><span>,</span></span><span> cyclic_modules </span><span class="main"><span>=</span></span><span> </span><span>false</span><span class="main"><span>,</span></span><span>
        class_transitive </span><span class="main"><span>=</span></span><span> </span><span>true</span><span class="main"><span>,</span></span><span> class_relation_public </span><span class="main"><span>=</span></span><span> </span><span>true</span><span class="main"><span>,</span></span><span> empty_data </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        memorize_data </span><span class="main"><span>=</span></span><span> </span><span>K</span><span> </span><span>I</span><span class="main"><span>,</span></span><span> modify_stmts </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>modify_stmt</span></span><span> </span><span class="main"><span>}</span></span><span>
      </span><span class="entity"><span>exports</span></span><span> </span><span class="entity"><span>program</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>




</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>serialize_go</span></span><span> </span><span class="entity"><span>gen_stringer</span></span><span> </span><span class="entity"><span>go_module</span></span><span> </span><span class="entity"><span>undefineds</span></span><span> </span><span class="entity"><span>infinite_types</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>{</span></span><span> </span><span class="entity"><span>module_name</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>reserved_syms</span></span><span class="main"><span>,</span></span><span>
     </span><span class="entity"><span>identifiers</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>includes</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>class_syntax</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tyco_syntax</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>const_syntax</span></span><span> </span><span class="main"><span>}</span></span><span> </span><span class="entity"><span>program</span></span><span> </span><span class="entity"><span>exports</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="comment1"><span>(* build program *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>{</span></span><span> </span><span class="entity"><span>deresolver</span></span><span class="main"><span>,</span></span><span> hierarchical_program </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>go_program</span></span><span> </span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>go_program_of_program</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>module_name</span></span><span> </span><span class="main"><span>(</span></span><span>Name.make_context</span><span> </span><span class="entity"><span>reserved_syms</span></span><span class="main"><span>)</span></span><span>
        </span><span class="entity"><span>identifiers</span></span><span> </span><span class="entity"><span>exports</span></span><span> </span><span class="entity"><span>program</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>go_module</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>go_module</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>""</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="inner_quoted"><span>"isabelle/exported"</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>go_module</span></span><span class="main"><span>;</span></span><span>

    </span><span class="comment1"><span>(* helper functions that need access to the entire program *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>lookup_constr</span></span><span> </span><span class="entity"><span>tyco</span></span><span> </span><span class="entity"><span>constr</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>Code_Symbol.Graph.get_node</span><span> </span><span class="entity"><span>program</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Type_Constructor</span></span><span> </span><span class="entity"><span>tyco</span></span><span class="main"><span>)</span></span><span>
     </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span class="entity"><span>Code_Thingol.Datatype</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>constrs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
           </span><span class="main"><span>(</span></span><span>AList.lookup</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>o</span><span> </span><span>apsnd</span><span> </span><span>fst</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>constrs</span></span><span> </span><span class="entity"><span>constr</span></span><span class="main"><span>)</span></span><span>
       </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>NONE</span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>is_sum_type</span></span><span> </span><span class="entity"><span>sym</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>Code_Symbol.Graph.get_node</span><span> </span><span class="entity"><span>program</span></span><span> </span><span class="entity"><span>sym</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
     </span><span class="entity"><span>Code_Thingol.Datatypecons</span></span><span> </span><span class="entity"><span>tyco</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>Code_Symbol.Graph.get_node</span><span> </span><span class="entity"><span>program</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Type_Constructor</span></span><span> </span><span class="entity"><span>tyco</span></span><span class="main"><span>)</span></span><span>
     </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span class="entity"><span>Code_Thingol.Datatype</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>false</span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Code_Thingol.Datatype</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>_</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>false</span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Code_Thingol.Datatype</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>true</span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>false</span><span class="main"><span>)</span></span><span>
     </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>false</span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>is_class_param</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>sym</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="entity"><span>Constant</span></span><span> </span><span class="entity"><span>const</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>Code_Symbol.Graph.get_node</span><span> </span><span class="entity"><span>program</span></span><span> </span><span class="entity"><span>sym</span></span><span>
     </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span class="entity"><span>Code_Thingol.Classparam</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>true</span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>false</span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>classparams_of_class</span></span><span> </span><span class="entity"><span>class</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>Code_Symbol.Graph.get_node</span><span> </span><span class="entity"><span>program</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Type_Class</span></span><span> </span><span class="entity"><span>class</span></span><span class="main"><span>)</span></span><span>
     </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span class="entity"><span>Code_Thingol.Class</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>classparams</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>classparams</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>args_num</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>sym</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="entity"><span>Constant</span></span><span> </span><span class="entity"><span>const</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>Code_Symbol.Graph.get_node</span><span> </span><span class="entity"><span>program</span></span><span> </span><span class="entity"><span>sym</span></span><span>
     </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span class="entity"><span>Code_Thingol.Fun</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="main"><span>(</span></span><span>length</span><span> </span><span>o</span><span> </span><span>fst</span><span> </span><span>o</span><span> </span><span class="entity"><span>Code_Thingol.unfold_fun</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ty</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Code_Thingol.Fun</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>ts</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>::</span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>length</span><span> </span><span class="entity"><span>ts</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Code_Thingol.Datatypecons</span></span><span> </span><span class="entity"><span>tyco</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>length</span><span> </span><span class="main"><span>(</span></span><span>the</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>lookup_constr</span></span><span> </span><span class="entity"><span>tyco</span></span><span> </span><span class="entity"><span>const</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Code_Thingol.Classparam</span></span><span> </span><span class="entity"><span>class</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="main"><span>(</span></span><span>length</span><span> </span><span>o</span><span> </span><span>fst</span><span> </span><span>o</span><span> </span><span class="entity"><span>Code_Thingol.unfold_fun</span></span><span> </span><span>o</span><span> </span><span>the</span><span> </span><span>o</span><span> </span><span>AList.lookup</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span>
            </span><span class="main"><span>(</span></span><span class="entity"><span>classparams_of_class</span></span><span> </span><span class="entity"><span>class</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>const</span></span><span class="main"><span>;</span></span><span>
    </span><span class="comment1"><span>(* print the go code *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_stmt</span></span><span> </span><span class="entity"><span>prefix_fragments</span></span><span> </span><span class="entity"><span>b</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>""</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>print_go_stmt</span></span><span> </span><span class="entity"><span>gen_stringer</span></span><span> </span><span class="entity"><span>undefineds</span></span><span> </span><span class="entity"><span>infinite_types</span></span><span>
      </span><span class="entity"><span>tyco_syntax</span></span><span> </span><span class="entity"><span>const_syntax</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>make_vars</span></span><span> </span><span class="entity"><span>reserved_syms</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>args_num</span></span><span> </span><span class="entity"><span>is_sum_type</span></span><span> </span><span class="entity"><span>is_class_param</span></span><span>
      </span><span class="main"><span>(</span></span><span class="entity"><span>Code_Thingol.is_constr</span></span><span> </span><span class="entity"><span>program</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>deresolver</span></span><span> </span><span class="entity"><span>prefix_fragments</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>deresolver</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>b</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>get_imports</span></span><span> </span><span class="entity"><span>module_name</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Module</span></span><span> </span><span class="entity"><span>module_name</span></span><span>
      </span><span>|&gt;</span><span> </span><span>Code_Symbol.Graph.immediate_succs</span><span> </span><span class="entity"><span>go_program</span></span><span>
      </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Module</span></span><span> </span><span class="entity"><span>a</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>a</span></span><span class="main"><span>)</span></span><span>
      </span><span>|&gt;</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>@</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>fst</span><span> </span><span class="entity"><span>includes</span></span><span class="main"><span>)</span></span><span>
      </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>a</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>go_module</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"/"</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>a</span></span><span class="main"><span>)</span></span><span>

    </span><span class="comment1"><span>(* print modules *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_module</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="entity"><span>base</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="entity"><span>ps</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>base</span></span><span class="main"><span>,</span></span><span> </span><span>Pretty.chunks2</span><span>
      </span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"package "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>base</span></span><span class="main"><span>)</span></span><span>
      </span><span>::</span><span> </span><span class="entity"><span>block_enclose</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"import ("</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>")"</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>print_go_string</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>get_imports</span></span><span> </span><span class="entity"><span>base</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span>::</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>snd</span><span> </span><span class="entity"><span>ps</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>


    </span><span class="comment1"><span>(* serialization *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>p</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Code_Namespace.print_hierarchical</span></span><span> </span><span class="main"><span>{</span></span><span>
        print_module </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>print_module</span></span><span class="main"><span>,</span></span><span> print_stmt </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>print_stmt</span></span><span class="main"><span>,</span></span><span>
        lift_markup </span><span class="main"><span>=</span></span><span> </span><span>K</span><span> </span><span>I</span><span> </span><span class="main"><span>}</span></span><span> </span><span class="entity"><span>go_program</span></span><span>
     </span><span>|&gt;</span><span> </span><span>curry</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>@</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>includes</span></span><span>
     </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>apfst</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>a</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>a</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"exported.go"</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>is_single_module</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>length</span><span> </span><span class="entity"><span>p</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="main"><span>(</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_single_module</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>Code_Target.Singleton</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"go"</span></span><span class="main"><span>,</span></span><span> </span><span>snd</span><span> </span><span class="main"><span>(</span></span><span>hd</span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>Code_Target.Hierarchy</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="inner_quoted"><span>"go.mod"</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span>Pretty.chunks2</span><span> </span><span class="main"><span>[</span></span><span>
        </span><span class="entity"><span>concat</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"module"</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>print_go_string</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>go_module</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"go 1.18"</span></span><span>
      </span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
    </span><span>try</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>deresolver</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>


</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>serializer</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Code_Target.serializer</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>Code_Target.parse_args</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>Scan.optional</span><span> </span><span class="main"><span>(</span></span><span>Args.$$$</span><span> </span><span class="inner_quoted"><span>"go_module"</span></span><span> </span><span>|--</span><span> </span><span>Args.name</span><span class="main"><span>)</span></span><span> </span><span class="inner_quoted"><span>""</span></span><span>
      </span><span>--</span><span> </span><span>Scan.optional</span><span> </span><span class="main"><span>(</span></span><span>Args.$$$</span><span> </span><span class="inner_quoted"><span>"gen_stringer"</span></span><span> </span><span>&gt;&gt;</span><span> </span><span>K</span><span> </span><span>true</span><span class="main"><span>)</span></span><span> </span><span>false</span><span>
      </span><span>--</span><span> </span><span>Scan.optional</span><span> </span><span class="main"><span>(</span></span><span>Args.$$$</span><span> </span><span class="inner_quoted"><span>"panic_on"</span></span><span> </span><span>|--</span><span> </span><span class="main"><span>(</span></span><span>Scan.repeat</span><span> </span><span>Parse.term</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
      </span><span>--</span><span> </span><span>Scan.optional</span><span> </span><span class="main"><span>(</span></span><span>Args.$$$</span><span> </span><span class="inner_quoted"><span>"infinite_type"</span></span><span> </span><span>|--</span><span> </span><span class="main"><span>(</span></span><span>Scan.repeat</span><span> </span><span>Parse.term</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
  </span><span>&gt;&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>go_module</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>gen_stringer</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>undef_terms</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>infinite_types</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
         </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>undefineds</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span>o</span><span> </span><span>dest_Const</span><span> </span><span>o</span><span> </span><span>Syntax.read_term</span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>undef_terms</span></span><span>
         </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>infinite_types</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span>o</span><span> </span><span>dest_Type</span><span> </span><span>o</span><span> </span><span>Syntax.parse_typ</span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>infinite_types</span></span><span>
       </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>serialize_go</span></span><span> </span><span class="entity"><span>gen_stringer</span></span><span> </span><span class="entity"><span>go_module</span></span><span> </span><span class="entity"><span>undefineds</span></span><span> </span><span class="entity"><span>infinite_types</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>


</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Theory.setup</span><span>
  </span><span class="main"><span>(</span></span><span class="entity"><span>Code_Target.add_language</span></span><span>
    </span><span class="main"><span>(</span></span><span class="entity"><span>target</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>{</span></span><span> serializer </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>serializer</span></span><span class="main"><span>,</span></span><span> literals </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>literals</span></span><span class="main"><span>,</span></span><span>
      check </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>{</span></span><span> env_var </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"ISABELLE_GO"</span></span><span class="main"><span>,</span></span><span>
        make_destination </span><span class="main"><span>=</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>p</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>p</span></span><span> </span><span>+</span><span> </span><span>Path.explode</span><span> </span><span class="inner_quoted"><span>"export.go"</span></span><span class="main"><span>,</span></span><span>
        make_command </span><span class="main"><span>=</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>p</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="inner_quoted"><span>"test -d export.go &amp;&amp; cd export.go &amp;&amp; $ISABELLE_GO build ./"</span></span><span>^</span><span class="entity"><span>p</span></span><span>^</span><span class="inner_quoted"><span>" || $ISABELLE_GO build ./export.go"</span></span><span class="main"><span>}</span></span><span class="main"><span>,</span></span><span>
      evaluation_args </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span>
  </span><span>#&gt;</span><span> </span><span class="entity"><span>Code_Target.set_printings</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Type_Constructor</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"fun"</span></span><span class="main"><span>,</span></span><span>
    </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>target</span></span><span class="main"><span>,</span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>2</span></span><span class="main"><span>,</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>print_go_typ</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>arg</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rtyp</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>head</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>applify</span></span><span> </span><span class="inner_quoted"><span>"("</span></span><span> </span><span class="inner_quoted"><span>")"</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print_go_typ</span></span><span> </span><span class="entity"><span>fxy</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>NOBR</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"func"</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>arg</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>concat</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>head</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>print_go_typ</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="entity"><span>rtyp</span></span><span class="main"><span>]</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>)</span></span><span>
    </span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
  </span><span>#&gt;</span><span> </span><span>fold</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Code_Target.add_reserved</span></span><span> </span><span class="entity"><span>target</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span>
      </span><span class="inner_quoted"><span>"any"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"break"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"default"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"func"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"interface"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"select"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"case"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"defer"</span></span><span class="main"><span>,</span></span><span>
      </span><span class="inner_quoted"><span>"go"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"map"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"struct"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"chan"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"else"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"goto"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"package"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"switch"</span></span><span class="main"><span>,</span></span><span>
      </span><span class="inner_quoted"><span>"const"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"fallthrough"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"if"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"range"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"type"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"continue"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"for"</span></span><span class="main"><span>,</span></span><span>
      </span><span class="inner_quoted"><span>"import"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"return"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"var"</span></span><span>
    </span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>


</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span> </span><span class="comment1"><span>(*struct*)</span></span><span>
</span></pre>
</body>

</html>